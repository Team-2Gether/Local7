<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.twogether.local7.user.dao.UserDAO">

    <resultMap id="userResultMap" type="com.twogether.local7.user.vo.UserVO">
        <id property="userId" column="USER_ID"/>
        <result property="userLoginId" column="USER_LOGIN_ID"/>
        <result property="userUsername" column="USER_USERNAME"/>
        <result property="userPassword" column="USER_PASSWORD"/>
        <result property="userEmail" column="USER_EMAIL"/>
        <result property="userNickname" column="USER_NICKNAME"/>
        <result property="userProfileImageUrl" column="USER_PROFILE_IMAGE_URL"/>
        <result property="userBio" column="USER_BIO"/>
        <result property="ruleId" column="RULE_ID"/>
        <result property="ruleName" column="RULE_NAME"/>
    </resultMap>

    <select id="findByUserLoginId" parameterType="string" resultMap="userResultMap">
        SELECT
        T.USER_ID,
        T.USER_LOGIN_ID,
        T.USER_USERNAME,
        T.USER_PASSWORD,
        T.USER_EMAIL,
        T.USER_NICKNAME,
        T.USER_PROFILE_IMAGE_URL,
        T.USER_BIO,
        T.RULE_ID,
        R.RULE_NAME
        FROM
        TB_USER T
        LEFT JOIN
        TB_RULE R ON T.RULE_ID = R.RULE_ID
        WHERE
        T.USER_LOGIN_ID = #{userLoginId}
    </select>

    <select id="findByUserEmail" parameterType="string" resultMap="userResultMap">
        SELECT
        T.USER_ID,
        T.USER_LOGIN_ID,
        T.USER_USERNAME,
        T.USER_PASSWORD,
        T.USER_EMAIL,
        T.USER_NICKNAME,
        T.USER_PROFILE_IMAGE_URL,
        T.USER_BIO,
        T.RULE_ID,
        R.RULE_NAME
        FROM
        TB_USER T
        LEFT JOIN
        TB_RULE R ON T.RULE_ID = R.RULE_ID
        WHERE
        T.USER_EMAIL = #{userEmail}
    </select>

    <select id="countByUserLoginId" parameterType="string" resultType="int">
        SELECT COUNT(*) FROM TB_USER WHERE USER_LOGIN_ID = #{userLoginId}
    </select>

    <update id="updateUserLoginId">
        UPDATE TB_USER
        SET USER_LOGIN_ID = #{param2}
        WHERE USER_ID = #{param1}
    </update>

    <update id="updateUserPassword">
        UPDATE TB_USER
        SET USER_PASSWORD = #{param2}
        WHERE USER_ID = #{param1}
    </update>
</mapper>
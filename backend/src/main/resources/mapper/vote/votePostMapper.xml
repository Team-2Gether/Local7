<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.twogether.local7.vote.dao.VotePostDAO">

    <resultMap id="votePostMap" type="com.twogether.local7.vote.vo.VotePostVO">
        <id property="postId" column="POST_ID"/>
        <result property="postTitle" column="POST_TITLE"/>
        <result property="postContent" column="POST_CONTENT"/>
        <result property="createdDate" column="CREATE_DATE"/>
        <result property="locationTag" column="LOCATION_TAG"/>
        <result property="userCount" column="USER_COUNT"/>
    </resultMap>

<!--    <select id="getAllPosts" resultMap="votePostMap">-->
<!--        SELECT *-->
<!--        FROM (-->
<!--        SELECT post_id, COUNT(user_id) AS user_count-->
<!--        FROM tb_like-->
<!--        GROUP BY post_id-->
<!--        ORDER BY user_count DESC-->
<!--        )-->
<!--        WHERE ROWNUM <= 10-->
<!--    </select>-->

    <select id="getAllPosts" resultMap="votePostMap">
        SELECT *
        FROM (
        SELECT p.post_id,
        p.post_title,
        p.post_content,
        p.created_date,
        p.location_tag,
        l.user_count
        FROM (
        SELECT post_id, COUNT(user_id) AS user_count
        FROM tb_like
        GROUP BY post_id
        ) l
        JOIN tb_post p ON l.post_id = p.post_id
        ORDER BY l.user_count DESC
        )
        WHERE ROWNUM <= 10
    </select>



</mapper>

